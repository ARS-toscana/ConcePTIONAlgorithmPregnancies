################################ MEANING_OF_SURVEY ##################################
meaning_of_survey_our_study <- vector(mode="list")

meaning_of_survey_our_study[["ARS"]][["livebirth_or_stillbirth"]]<-list("birth_registry_mother")
meaning_of_survey_our_study[["ARS"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["ARS"]][["spontaneous_abortion"]]<-list("spontaneous_abortion_registry")
meaning_of_survey_our_study[["ARS"]][["induced_termination"]]<-list("induced_termination_registry")
meaning_of_survey_our_study[["ARS"]][["other"]]<-list()

meaning_of_survey_our_study[["UOSL"]][["livebirth_or_stillbirth"]]<-list("birth_registry_mother") #, "birth_registry_father", "birth_registry_child"
meaning_of_survey_our_study[["UOSL"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["UOSL"]][["spontaneous_abortion"]]<-list()
meaning_of_survey_our_study[["UOSL"]][["induced_termination"]]<-list()
meaning_of_survey_our_study[["UOSL"]][["other"]]<-list()

meaning_of_survey_our_study[["AARHUS"]][["livebirth_or_stillbirth"]]<-list("birth_registry")
meaning_of_survey_our_study[["AARHUS"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["AARHUS"]][["spontaneous_abortion"]]<-list()
meaning_of_survey_our_study[["AARHUS"]][["induced_termination"]]<-list()
meaning_of_survey_our_study[["AARHUS"]][["other"]]<-list()

meaning_of_survey_our_study[["CHUT"]][["livebirth_or_stillbirth"]]<-list("pregnancy_characteristics")
meaning_of_survey_our_study[["CHUT"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["CHUT"]][["spontaneous_abortion"]]<-list("pregnancy_characteristics")
meaning_of_survey_our_study[["CHUT"]][["induced_termination"]]<-list("pregnancy_characteristics")
meaning_of_survey_our_study[["CHUT"]][["other"]]<-list()

meaning_of_survey_our_study[["GePaRD"]][["livebirth_or_stillbirth"]]<-list("algorithm_pregnancy") 
meaning_of_survey_our_study[["GePaRD"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["GePaRD"]][["spontaneous_abortion"]]<-list("algorithm_pregnancy") 
meaning_of_survey_our_study[["GePaRD"]][["induced_termination"]]<-list("algorithm_pregnancy") 
meaning_of_survey_our_study[["GePaRD"]][["other"]]<-list()

meaning_of_survey_our_study[["BIFAP"]][["livebirth_or_stillbirth"]]<-list("algorithm_pregnancy")
meaning_of_survey_our_study[["BIFAP"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["BIFAP"]][["spontaneous_abortion"]]<-list("algorithm_pregnancy")
meaning_of_survey_our_study[["BIFAP"]][["induced_termination"]]<-list("algorithm_pregnancy")
meaning_of_survey_our_study[["BIFAP"]][["other"]]<-list()

meaning_of_survey_our_study[["FISABIO"]][["livebirth_or_stillbirth"]]<-list("META-B_mother", "RMPCV_mother")
meaning_of_survey_our_study[["FISABIO"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["FISABIO"]][["spontaneous_abortion"]]<-list()
meaning_of_survey_our_study[["FISABIO"]][["induced_termination"]]<-list()
meaning_of_survey_our_study[["FISABIO"]][["other"]]<-list("RPAC-CV-mother")

meaning_of_survey_our_study[["SIDIAP"]][["livebirth_or_stillbirth"]]<-list("birth_registry")
meaning_of_survey_our_study[["SIDIAP"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["SIDIAP"]][["spontaneous_abortion"]]<-list("spontaneous_abortion_registry")
meaning_of_survey_our_study[["SIDIAP"]][["induced_termination"]]<-list("induced_termination_registry")
meaning_of_survey_our_study[["SIDIAP"]][["other"]]<-list()

meaning_of_survey_our_study[["UNIME"]][["livebirth_or_stillbirth"]]<-list("birth_registry_mother")
meaning_of_survey_our_study[["UNIME"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["UNIME"]][["spontaneous_abortion"]]<-list("spontaneous_abortion_registry")
meaning_of_survey_our_study[["UNIME"]][["induced_termination"]]<-list("induced_termination_registry")
meaning_of_survey_our_study[["UNIME"]][["other"]]<-list()

meaning_of_survey_our_study[["THL"]][["livebirth_or_stillbirth"]]<-list("birth_registry")
meaning_of_survey_our_study[["THL"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["THL"]][["spontaneous_abortion"]]<-list()
meaning_of_survey_our_study[["THL"]][["induced_termination"]]<-list("induced_termination_registry")
meaning_of_survey_our_study[["THL"]][["other"]]<-list()

meaning_of_survey_our_study[["CPRD"]][["livebirth_or_stillbirth"]]<-list("pregnancy_register")
meaning_of_survey_our_study[["CPRD"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["CPRD"]][["spontaneous_abortion"]]<-list("pregnancy_register")
meaning_of_survey_our_study[["CPRD"]][["induced_termination"]]<-list("pregnancy_register")
meaning_of_survey_our_study[["CPRD"]][["other"]]<-list()

meaning_of_survey_our_study[["CNR-IFC"]][["livebirth_or_stillbirth"]]<-list("birth_registry_mother", "birth_registry_child")
meaning_of_survey_our_study[["CNR-IFC"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["CNR-IFC"]][["spontaneous_abortion"]]<-list()
meaning_of_survey_our_study[["CNR-IFC"]][["induced_termination"]]<-list()
meaning_of_survey_our_study[["CNR-IFC"]][["other"]]<-list()

meaning_of_survey_our_study[["PEDIANET"]][["livebirth_or_stillbirth"]]<-list()
meaning_of_survey_our_study[["PEDIANET"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["PEDIANET"]][["spontaneous_abortion"]]<-list()
meaning_of_survey_our_study[["PEDIANET"]][["induced_termination"]]<-list()
meaning_of_survey_our_study[["PEDIANET"]][["other"]]<-list()


meaning_of_survey_our_study[["TEST"]][["livebirth_or_stillbirth"]]<-list("algorithm_pregnancy") 
meaning_of_survey_our_study[["TEST"]][["ongoing_pregnancy"]]<-list()
meaning_of_survey_our_study[["TEST"]][["spontaneous_abortion"]]<-list("algorithm_pregnancy") 
meaning_of_survey_our_study[["TEST"]][["induced_termination"]]<-list("algorithm_pregnancy") 
meaning_of_survey_our_study[["TEST"]][["other"]]<-list()

meaning_of_survey_our_study_this_datasource<-vector(mode="list")

for (i in 1:length(meaning_of_survey_our_study)) {
  if(names(meaning_of_survey_our_study)[[i]]==thisdatasource) meaning_of_survey_our_study_this_datasource<-meaning_of_survey_our_study[[i]]
}

################################ TYPE ##################################
dictonary_of_itemset <- vector(mode="list") # dictonary_of_itemset[["TYPE"]][["ARS"]][["LB"]] -> copiare in algorithm

dictonary_of_itemset[["TYPE"]][["ARS"]][["LB"]]<-list(list("CAP2", "1"))
dictonary_of_itemset[["TYPE"]][["ARS"]][["SB"]]<-list(list("CAP2", "2"))
dictonary_of_itemset[["TYPE"]][["ARS"]][["SA"]]<-list()
dictonary_of_itemset[["TYPE"]][["ARS"]][["T"]]<-list()
dictonary_of_itemset[["TYPE"]][["ARS"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["ARS"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["ARS"]][["UNK"]]<-list()

dictonary_of_itemset[["TYPE"]][["UOSL"]][["LB"]]<-list(list("MBRN", "0"), list("MBRN", "1"), list("MBRN", "2"), list("MBRN", "3"), list("MBRN", "4"), list("MBRN", "5"), list("MBRN", "6"), list("MBRN", "11"), list("MBRN", "12"), list("MBRN", "13"))
dictonary_of_itemset[["TYPE"]][["UOSL"]][["SB"]]<-list(list("MBRN", "7"), list("MBRN", "8"), list("MBRN", "9"))
dictonary_of_itemset[["TYPE"]][["UOSL"]][["SA"]]<-list()
dictonary_of_itemset[["TYPE"]][["UOSL"]][["T"]]<-list(list("MBRN", "10")) #?
dictonary_of_itemset[["TYPE"]][["UOSL"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["UOSL"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["UOSL"]][["UNK"]]<-list()

dictonary_of_itemset[["TYPE"]][["AARHUS"]][["LB"]]<-list(list("MFR", "1"))
dictonary_of_itemset[["TYPE"]][["AARHUS"]][["SB"]]<-list(list("MFR", "0"))
dictonary_of_itemset[["TYPE"]][["AARHUS"]][["SA"]]<-list()
dictonary_of_itemset[["TYPE"]][["AARHUS"]][["T"]]<-list()
dictonary_of_itemset[["TYPE"]][["AARHUS"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["AARHUS"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["AARHUS"]][["UNK"]]<-list()

dictonary_of_itemset[["TYPE"]][["CHUT"]][["LB"]]<-list(list("EFEMERIS_ISSUE", "1"))
dictonary_of_itemset[["TYPE"]][["CHUT"]][["SB"]]<-list(list("EFEMERIS_INTERRUPTION", "MFIU"), list("EFEMERIS_INTERRUPTION", "MORT-NES"))
dictonary_of_itemset[["TYPE"]][["CHUT"]][["SA"]]<-list(list("EFEMERIS_INTERRUPTION", "FCS"))
dictonary_of_itemset[["TYPE"]][["CHUT"]][["T"]]<-list(list("EFEMERIS_INTERRUPTION", "IVG"), list("EFEMERIS_INTERRUPTION", "IMG"))
dictonary_of_itemset[["TYPE"]][["CHUT"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["CHUT"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["CHUT"]][["UNK"]]<-list(list("EFEMERIS_INTERRUPTION", "AUTRE"))

dictonary_of_itemset[["TYPE"]][["GePaRD"]][["LB"]]<-list(list("T_PREG", "1"), list("T_PREG", "2"), list("T_PREG", "3"))
dictonary_of_itemset[["TYPE"]][["GePaRD"]][["SB"]]<-list(list("T_PREG", "4"))
dictonary_of_itemset[["TYPE"]][["GePaRD"]][["SA"]]<-list(list("T_PREG", "7"))
dictonary_of_itemset[["TYPE"]][["GePaRD"]][["T"]]<-list(list("T_PREG", "5"))
dictonary_of_itemset[["TYPE"]][["GePaRD"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["GePaRD"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["GePaRD"]][["UNK"]]<-list()

dictonary_of_itemset[["TYPE"]][["BIFAP"]][["LB"]]<-list(list("EMB_BIFAP", "1"))
dictonary_of_itemset[["TYPE"]][["BIFAP"]][["SB"]]<-list(list("EMB_BIFAP", "2"))
dictonary_of_itemset[["TYPE"]][["BIFAP"]][["SA"]]<-list()
dictonary_of_itemset[["TYPE"]][["BIFAP"]][["T"]]<-list(list("EMB_BIFAP", "3"))
dictonary_of_itemset[["TYPE"]][["BIFAP"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["BIFAP"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["BIFAP"]][["UNK"]]<-list()

dictonary_of_itemset[["TYPE"]][["FISABIO"]][["LB"]]<-list() #EUROmediCAT
dictonary_of_itemset[["TYPE"]][["FISABIO"]][["SB"]]<-list()
dictonary_of_itemset[["TYPE"]][["FISABIO"]][["SA"]]<-list()
dictonary_of_itemset[["TYPE"]][["FISABIO"]][["T"]]<-list()
dictonary_of_itemset[["TYPE"]][["FISABIO"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["FISABIO"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["FISABIO"]][["UNK"]]<-list()

dictonary_of_itemset[["TYPE"]][["SIDIAP"]][["LB"]]<-list(list("Pregnancies", "P"), list("Pregnancies", "Pr"), list("Pregnancies", "C"), list("Pregnancies", "Al")) 
dictonary_of_itemset[["TYPE"]][["SIDIAP"]][["SB"]]<-list()
dictonary_of_itemset[["TYPE"]][["SIDIAP"]][["SA"]]<-list(list("Pregnancies", "MF"), list("Pregnancies", "A"))
dictonary_of_itemset[["TYPE"]][["SIDIAP"]][["T"]]<-list(list("Pregnancies", "IV"))
dictonary_of_itemset[["TYPE"]][["SIDIAP"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["SIDIAP"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["SIDIAP"]][["UNK"]]<-list()

dictonary_of_itemset[["TYPE"]][["CNR-IFC"]][["LB"]]<-list() # EUROmediCAT
dictonary_of_itemset[["TYPE"]][["CNR-IFC"]][["SB"]]<-list()
dictonary_of_itemset[["TYPE"]][["CNR-IFC"]][["SA"]]<-list()
dictonary_of_itemset[["TYPE"]][["CNR-IFC"]][["T"]]<-list()
dictonary_of_itemset[["TYPE"]][["CNR-IFC"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["CNR-IFC"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["CNR-IFC"]][["UNK"]]<-list()

dictonary_of_itemset[["TYPE"]][["UNIME"]][["LB"]]<-list() # dubt
dictonary_of_itemset[["TYPE"]][["UNIME"]][["SB"]]<-list()
dictonary_of_itemset[["TYPE"]][["UNIME"]][["SA"]]<-list()
dictonary_of_itemset[["TYPE"]][["UNIME"]][["T"]]<-list()
dictonary_of_itemset[["TYPE"]][["UNIME"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["UNIME"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["UNIME"]][["UNK"]]<-list()

dictonary_of_itemset[["TYPE"]][["THL"]][["LB"]]<-list(list("SR_BASIC", "1"), list("SR_BASIC", "3"), list("ER_BASIC", "1"))
dictonary_of_itemset[["TYPE"]][["THL"]][["SB"]]<-list(list("SR_BASIC", "2"), list("SR_BASIC", "4"), list("ER_BASIC", "2"))
dictonary_of_itemset[["TYPE"]][["THL"]][["SA"]]<-list(list("ER_BASIC", "3"))
dictonary_of_itemset[["TYPE"]][["THL"]][["T"]]<-list(list("ER_BASIC", "4"), list("ER_BASIC", "5"), list("ER_BASIC", "6"), list("ER_BASIC", "7"), list("ER_BASIC", "11"), list("ER_BASIC", "12"))
dictonary_of_itemset[["TYPE"]][["THL"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["THL"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["THL"]][["UNK"]]<-list(list("ER_BASIC", "99"))

dictonary_of_itemset[["TYPE"]][["CPRD"]][["LB"]]<-list(list("pregnancy_register", "1"))
dictonary_of_itemset[["TYPE"]][["CPRD"]][["SB"]]<-list(list("pregnancy_register", "2"))
dictonary_of_itemset[["TYPE"]][["CPRD"]][["SA"]]<-list(list("pregnancy_register", "4"))
dictonary_of_itemset[["TYPE"]][["CPRD"]][["T"]]<-list(list("pregnancy_register", "5"))
dictonary_of_itemset[["TYPE"]][["CPRD"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["CPRD"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["CPRD"]][["UNK"]]<-list(list("pregnancy_register", "13"))

dictonary_of_itemset[["TYPE"]][["PEDIANET"]][["LB"]]<-list() 
dictonary_of_itemset[["TYPE"]][["PEDIANET"]][["SB"]]<-list()
dictonary_of_itemset[["TYPE"]][["PEDIANET"]][["SA"]]<-list()
dictonary_of_itemset[["TYPE"]][["PEDIANET"]][["T"]]<-list()
dictonary_of_itemset[["TYPE"]][["PEDIANET"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["PEDIANET"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["PEDIANET"]][["UNK"]]<-list()


dictonary_of_itemset[["TYPE"]][["TEST"]][["LB"]]<-list(list("T_PREG", "1"), list("T_PREG", "2"), list("T_PREG", "3"), list("EMB_BIFAP", "1"))
dictonary_of_itemset[["TYPE"]][["TEST"]][["SB"]]<-list(list("T_PREG", "4"), list("EMB_BIFAP", "2"))
dictonary_of_itemset[["TYPE"]][["TEST"]][["SA"]]<-list(list("T_PREG", "7"))
dictonary_of_itemset[["TYPE"]][["TEST"]][["T"]]<-list(list("T_PREG", "5"), list("EMB_BIFAP", "3"))
dictonary_of_itemset[["TYPE"]][["TEST"]][["MD"]]<-list()
dictonary_of_itemset[["TYPE"]][["TEST"]][["ECT"]]<-list()
dictonary_of_itemset[["TYPE"]][["TEST"]][["UNK"]]<-list()


dictonary_of_itemset_this_datasource<-vector(mode="list")

for (i in 1:length(dictonary_of_itemset$TYPE)) {
  if(names(dictonary_of_itemset$TYPE)[[i]]==thisdatasource) dictonary_of_itemset_this_datasource<-dictonary_of_itemset$TYPE[[i]]
}






# we need to create two groups of meanings: one referring to hospitals HOSP (excluding emergency care) and one referring to primary care PC

meanings_of_this_study<-vector(mode="list")
meanings_of_this_study[["HOSP"]]=c("hospitalisation_primary","hospitalisation_secondary","hospital_diagnosis","hopitalisation_diagnosis_unspecified","episode_primary_diagnosis","episode_secondary_diagnosis","diagnosis_procedure","hospitalisation_associated","hospitalisation_linked","HH","NH")
meanings_of_this_study[["PC"]]=c("primary_care_event","primary_care_diagnosis","primary_care_events_BIFAP","primary_care_antecedents_BIFAP","primary_care_condicionants_BIFAP")

# create two conditions on the meaning_of_event variable, associated to HOSP and to PC as listed above

condmeaning <- list()
for (level1 in c("HOSP","PC")) {
  for (meaning in meanings_of_this_study[[level1]]) {
    if (length(condmeaning[[level1]])==0) {condmeaning[[level1]]=paste0("meaning=='",meanings_of_this_study[[level1]][[1]],"'") #meaning_of_event
    }else{
      condmeaning[[level1]]=paste0(condmeaning[[level1]], " | meaning=='",meaning,"'") #_of_event
    }
  }
}

rm(meaning)

#-------------------------------------
# set concept sets

# concept_set_codes_our_study <- c(concept_sets_of_our_study_eve, concept_set_our_study_pre, concept_sets_of_our_study_eve_procedure)
concept_set_codes_our_study_excl <- concept_set_codes_our_study_excl

# augment ICPC codes
# for (outcome in OUTCOME_events){
#   outnarrow <- paste0(outcome,'_narrow')
#   outpossible <- paste0(outcome,'_possible')
#   if (length(concept_set_codes_our_study_pre[[outnarrow]][["ICPC"]]) == 0 & length(concept_set_codes_our_study_pre[[outnarrow]][["ICPC2P"]]) >0 ){
#     concept_set_codes_our_study[[outpossible]][["ICPC"]] <- unique(c(concept_set_codes_our_study_pre[[outpossible]][["ICPC"]],substr(concept_set_codes_our_study_pre[[outnarrow]][["ICPC2P"]],1,3)))
#   }
# }

# for (conceptset in c(COV_conceptssets,SEVERCOVID_conceptsets)){
#   if (length(concept_set_codes_our_study_pre[[conceptset]][["ICPC2P"]]) >0 ){
#     concept_set_codes_our_study[[conceptset]][["ICPC"]] <- unique(c(concept_set_codes_our_study_pre[[conceptset]][["ICPC"]],substr(concept_set_codes_our_study_pre[[conceptset]][["ICPC2P"]],1,3)))
#   }
# }

#-------------------------------------
# fix for ICPC2P

for (conceptset in concept_set_our_study){
  if (length(concept_set_codes_our_study[[conceptset]][["ICPC2P"]]) >0 ){
    concept_set_codes_our_study[[conceptset]][["ICPC"]] <- unique(c(concept_set_codes_our_study[[conceptset]][["ICPC"]],substr(concept_set_codes_our_study[[conceptset]][["ICPC2P"]],1,3)))
  }
}



#-------------------------------------
# fix for ICD10GM

for (conceptset in concept_set_our_study){
  #print(conceptset)
  if (concept_set_domains[[conceptset]] == "Diagnosis"){
    concept_set_codes_our_study[[conceptset]][["ICD10GM"]] <- concept_set_codes_our_study[[conceptset]][["ICD10"]]
  }
}

#-------------------------------------
# fix for ICD10CM
for (conceptset in concept_set_our_study){
  if (concept_set_domains[[conceptset]] == "Diagnosis"){
    concept_set_codes_our_study[[conceptset]][["ICD10CM"]] <- concept_set_codes_our_study[[conceptset]][["ICD10"]]
  }
}

#-------------------------------------
# fix for CIM10
for (conceptset in concept_set_our_study){
  if (concept_set_domains[[conceptset]] == "Diagnosis"){
    concept_set_codes_our_study[[conceptset]][["CIM10"]] <- concept_set_codes_our_study[[conceptset]][["ICD10"]]
  }
}

#-------------------------------------
# fix for SNOMED3
for (conceptset in concept_set_our_study){
  if (concept_set_domains[[conceptset]] == "Diagnosis"){
    concept_set_codes_our_study[[conceptset]][["SNOMED3"]] <- concept_set_codes_our_study[[conceptset]][["SNOMED"]]
  }
}

save(concept_set_codes_our_study,file=paste0(direxp,"concept_set_codes_our_study.RData"))
save(concept_set_codes_our_study_excl,file=paste0(direxp,"concept_set_codes_our_study_excl.RData"))
save(concept_set_codes_our_study,file=paste0(dirsmallcountsremoved,"concept_set_codes_our_study.RData"))
save(concept_set_codes_our_study_excl,file=paste0(dirsmallcountsremoved,"concept_set_codes_our_study_excl.RData"))

if (this_datasource_has_subpopulations == TRUE){
  for (subpop in subpopulations[[thisdatasource]]){
    save(concept_set_codes_our_study,file=paste0(direxpsubpop[[subpop]],"concept_set_codes_our_study.RData"))
    save(concept_set_codes_our_study_excl,file=paste0(direxpsubpop[[subpop]],"concept_set_codes_our_study_excl.RData"))
    save(concept_set_codes_our_study_excl,file=paste0(dirsmallcountsremovedsubpop[[subpop]],"concept_set_codes_our_study_excl.RData"))
    
  }
}

